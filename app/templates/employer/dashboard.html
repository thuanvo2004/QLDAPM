{% extends "base.html" %}
{% block title %}Quản lý tin tuyển dụng - {{ current_user.employer_profile.company_name }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">

  <!-- HEADER -->
  <div class="bg-white rounded-2xl border p-6 mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="flex items-center gap-4">
      {% if current_user.employer_profile.logo %}
        <img src=" {{  current_user.employer_profile.logo }} "
             alt="{{ current_user.employer_profile.company_name }}"
             class="h-14 w-14 rounded-md object-cover border" />
      {% else %}
        <div class="h-14 w-14 rounded-md bg-gray-100 flex items-center justify-center text-gray-400">
          <i class="fa-regular fa-building text-xl"></i>
        </div>
      {% endif %}
      <div>
        <h1 class="text-2xl font-bold text-gray-900">{{ current_user.employer_profile.company_name }}</h1>
        <p class="text-sm text-gray-500">Trang quản lý tin tuyển dụng</p>
      </div>
    </div>

    <div class="flex items-center gap-3">
      <a href="{{ url_for('job.post_job') }}"
         class="inline-flex items-center gap-2 bg-[var(--primary-blue)] hover:bg-[var(--primary-blue-hover)] text-white px-4 py-2 rounded-lg text-sm font-medium transition">
        <i class="fa-regular fa-square-plus"></i> Đăng tin mới
      </a>
      <a href="{{ url_for('employer.profile') }}"
         class="inline-flex items-center gap-2 border !border-[var(--primary-blue)] hover:bg-[var(--primary-blue)] hover:text-white px-3 py-2 rounded-lg text-sm text-[var(--primary-blue)] transition">
        <i class="fa-regular fa-id-badge"></i> Hồ sơ công ty
      </a>
    </div>
  </div>

  <!-- SEARCH & FILTER -->
  <div class="bg-white rounded-xl border p-4 mb-6 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
    <form method="get" id="filter-form" class="flex flex-wrap gap-2 items-center">
    <!-- Ô search -->
    <div class="relative flex-1 min-w-[450px]">
      <input type="search" name="q" placeholder="Tìm theo tiêu đề, địa điểm..."
             value="{{ request.args.get('q','') }}"
             class="w-full border border-gray-200 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[var(--primary-blue)]">
      <button type="submit"
              class="absolute right-1 top-1 bottom-1 px-3 rounded-md bg-[var(--primary-blue)] hover:bg-[var(--primary-blue-hover)] text-white text-sm">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>
    </div>

    <!-- Lọc trạng thái -->
    <select name="status" class="border border-gray-200 rounded-lg px-3 py-2 text-sm"
            onchange="document.getElementById('filter-form').submit()">
      <option value="">Tất cả trạng thái</option>
      <option value="active" {% if request.args.get('status')=='is_active' %}selected{% endif %}>Đang hoạt động</option>
      <option value="expired" {% if request.args.get('status')=='expired' %}selected{% endif %}>Hết hạn</option>
    </select>

    <!-- Đặt lại -->
    <a href="{{ url_for('employer.dashboard') }}"
       class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--primary-blue)] hover:bg-[var(--primary-blue-hover)]">
      Đặt lại
    </a>
  </form>

    <!-- STATS -->
    <div class="flex items-center gap-3">
      <div class="text-center px-4 py-2 bg-gray-50 rounded-lg border">
        <div class="text-xs text-gray-500">Tổng tin</div>
        <div class="text-lg font-semibold text-gray-900">{{ total_jobs }}</div>
      </div>
      <div class="text-center px-4 py-2 bg-gray-50 rounded-lg border">
        <div class="text-xs text-gray-500">Đang hoạt động</div>
        <div class="text-lg font-semibold text-gray-900">{{ is_active }}</div>
      </div>
      <div class="text-center px-4 py-2 bg-gray-50 rounded-lg border">
        <div class="text-xs text-gray-500">Ứng viên chờ</div>
        <div class="text-lg font-semibold text-gray-900">{{ pending_applicants }}</div>
      </div>
    </div>
  </div>


  <!-- JOB LIST -->
  {% if jobs.items %}
    <div class="grid grid-cols-1 md:grid-cols-1 lg:grid-cols-2 gap-6">
      {% for job in jobs.items %}
        <div class="relative bg-white rounded-xl shadow-sm border hover:shadow-md transition transform hover:-translate-y-1 overflow-hidden">
          <div class="absolute left-0 top-0 h-full w-1 {% if job.is_active %}bg-[var(--primary-blue)]{% else %}bg-gray-200{% endif %}"></div>

          <div class="p-5 flex flex-col h-full">
            <div class="flex items-start gap-4">
              {% if job.employer and job.employer.logo %}
                <img src="{{ url_for('static', filename='uploads/company_logos/' ~ job.employer.logo) }}"
                     alt="{{ job.employer.company_name }}"
                     class="w-12 h-12 rounded-md object-cover border">
              {% else %}
                <div class="w-12 h-12 rounded-md bg-gray-100 flex items-center justify-center text-gray-400">
                  <i class="fa-regular fa-building"></i>
                </div>
              {% endif %}

              <div class="flex-1">
                <a href="{{ url_for('job.job_detail', job_id=job.id) }}"
                   class="text-lg font-semibold text-gray-900 hover:text-[var(--primary-blue)]">{{ job.title }}</a>
                <div class="text-sm text-gray-500 mt-1">{{ job.city or 'Địa điểm ẩn danh' }}</div>
                <div class="mt-2 flex flex-wrap gap-2">
                  <span class="px-2 py-0.5 bg-[var(--blue-bg)] text-[var(--primary-blue)] text-xs rounded-full">{{ job.job_type or 'Chưa xác định' }}</span>
                  <span class="px-2 py-0.5 bg-[var(--blue-bg)] text-[var(--primary-blue)] text-xs rounded-full">{{ job.remote_option or 'On-Site' }}</span>
                </div>

                <div class="mt-3 flex flex-wrap items-center gap-2 text-sm text-gray-600">
                  <div class="inline-flex items-center gap-2 px-2 py-1 rounded-full bg-gray-50 border">
                    <span class="font-semibold text-[var(--primary-blue)]">
                      {% if job.salary_min and job.salary_max %}
                        {{ "{:,.0f}".format(job.salary_min) }} - {{ "{:,.0f}".format(job.salary_max) }} {{ job.currency or 'VND' }}
                      {% elif job.salary_min %}
                        Từ {{ "{:,.0f}".format(job.salary_min) }} {{ job.currency or 'VND' }}
                      {% else %}
                        Thỏa thuận
                      {% endif %}
                    </span>
                  </div>

                  <div class="inline-flex items-center gap-2 px-2 py-1 rounded-full bg-gray-50 border">
                    <i class="fa-regular fa-calendar"></i>
                    <span>
                      {% if job.deadline %}Hạn: {{ job.deadline.strftime('%d/%m/%Y') }}{% else %}Không giới hạn{% endif %}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <p class="text-sm text-gray-600 mt-4 line-clamp-3">
              {{ job.description[:220] ~ ('…' if job.description|length > 220 else '') }}
            </p>

            <div class="mt-auto pt-4 flex items-center justify-between gap-3">
              <div class="flex items-center gap-3 text-sm text-gray-600">
                <div class="flex items-center gap-2">
                  <i class="fa-regular fa-user"></i>
                  <span class="font-medium">{{ job.applicants_count|default(0) }}</span>
                  <span class="text-xs text-gray-400">ứng viên</span>
                </div>

                <div>
                  {% if job.is_active %}
                    <span class="px-2 py-1 rounded-full text-xs bg-green-100 text-green-700 flex items-center gap-1">
                      <i class="fa-regular fa-circle-check"></i> Active
                    </span>
                  {% else %}
                    <span class="px-2 py-1 rounded-full text-xs bg-red-100 text-red-600 flex items-center gap-1">
                      <i class="fa-regular fa-calendar-xmark"></i> Expired
                    </span>
                  {% endif %}
                </div>
              </div>

              <div class="flex items-center gap-2">
                <a href="{{ url_for('employer.view_applicants', job_id=job.id) }}"
                   class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-[var(--primary-blue)] text-white text-sm hover:bg-[var(--primary-blue-hover)] transition">
                  <i class="fa-regular fa-folder-open"></i> Ứng viên
                </a>
                <a href="{{ url_for('employer.edit_job', job_id=job.id) }}"
                   class="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-200 text-sm text-gray-700 hover:shadow-sm transition">
                  <i class="fa-regular fa-pen-to-square"></i> Sửa
                </a>
                <form action="{{ url_for('employer.delete_job', job_id=job.id) }}" method="POST"
                      onsubmit="return confirm('Bạn có chắc muốn xóa tin này?');">
                  <button type="submit"
                          class="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-red-200 text-sm text-red-600 hover:bg-red-50 transition">
                    <i class="fa-regular fa-trash-can"></i> Xoá
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if jobs.pages > 1 %}
      <div class="mt-6 flex justify-center">
        {{ jobs.links()|safe }}
      </div>
    {% endif %}

  {% else %}
    <div class="bg-white rounded-xl shadow p-10 text-center">
      <div class="mx-auto w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center text-gray-400 text-4xl mb-4">
        <i class="fa-regular fa-folder-open"></i>
      </div>
      <h3 class="text-lg font-semibold text-gray-700">Bạn chưa có tin tuyển dụng nào</h3>
      <p class="text-sm text-gray-500 mt-2">Đăng tin mới và bắt đầu thu hút ứng viên cho công ty bạn.</p>
      <a href="{{ url_for('job.post_job') }}"
         class="mt-4 inline-flex items-center gap-2 px-4 py-2 bg-[var(--primary-blue)] text-white rounded-lg hover:bg-[var(--primary-blue-hover)] transition">
        <i class="fa-regular fa-square-plus"></i> Đăng tin mới
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
