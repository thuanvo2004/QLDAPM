{% extends "base.html" %}

{% block title %}Chat vá»›i {{ other_user.username }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h3>ğŸ’¬ Chat vá»›i {{ other_user.username }}</h3>
    <div class="chat-box border rounded p-3 mb-3" style="height: 400px; overflow-y: auto;">
        {% for msg in chat_messages %}
            <div class="mb-2 {% if msg.sender_id == current_user.id %}text-end{% endif %}">
                <small class="text-muted">
                    {{ "Báº¡n" if msg.sender_id == current_user.id else msg.sender.username }}
                    ({{ msg.created_at.strftime("%H:%M:%S %d-%m-%Y") }})
                </small><br>
                <span class="p-2 rounded {% if msg.sender_id == current_user.id %}bg-primary text-white{% else %}bg-light{% endif %}">
                    {{ msg.content }}
                </span>
            </div>
        {% else %}
            <p class="text-muted">ChÆ°a cÃ³ tin nháº¯n nÃ o.</p>
        {% endfor %}
    </div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        const input = form.querySelector("input[name='content']");

        form.addEventListener("submit", function () {
            setTimeout(() => {
                input.value = ""; // reset sau khi gá»­i
            }, 50);
        });
    });
</script>

    <!-- Form gá»­i tin nháº¯n -->
    <form method="POST" action="{{ url_for('messages.send_message_user', user_id=other_user.id) }}">
        <div class="input-group">
            <input type="text" name="content" class="form-control" placeholder="Nháº­p tin nháº¯n..." required>
            <button type="submit" class="btn btn-primary">Gá»­i</button>
        </div>
    </form>
</div>
{% endblock %}
